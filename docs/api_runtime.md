# C++ SDK API: Runtime Functions

The SpacetimeDB C++ Module SDK provides runtime functions to allow your Wasm module (specifically, your reducers and other module code) to interact with the SpacetimeDB host environment. These functions typically wrap lower-level C ABI calls (`spacetime_host_abi.h`) to provide a more convenient and type-safe C++ interface.

These functions are primarily found in the `SpacetimeDB` namespace, declared in `spacetime_sdk_runtime.h`.

## Logging

Functions for logging messages from your module. These messages are processed by the SpacetimeDB host.

### `SpacetimeDB::LogLevel`
An `enum class` defining the severity of log messages:
```cpp
namespace SpacetimeDB {
    enum class LogLevel : uint8_t {
        Error = 0, ///< Critical errors.
        Warn = 1,  ///< Warnings about potential issues.
        Info = 2,  ///< General informational messages.
        Debug = 3, ///< Detailed debugging information.
        Trace = 4  ///< Highly detailed trace information.
    };
}
```

### `SpacetimeDB::log()`
Logs a message with a specified log level.
```cpp
#include "spacetime_sdk_runtime.h" // Or your main SDK include

void SpacetimeDB::log(LogLevel level, const std::string& message);
```
*   **Parameters:**
    *   `level`: The `SpacetimeDB::LogLevel` for the message.
    *   `message`: The string message to log.

### Convenience Logging Functions
Wrappers around `SpacetimeDB::log()` for common levels:
```cpp
void SpacetimeDB::log_error(const std::string& message); // Logs with LogLevel::Error
void SpacetimeDB::log_warn(const std::string& message);  // Logs with LogLevel::Warn
void SpacetimeDB::log_info(const std::string& message);   // Logs with LogLevel::Info
void SpacetimeDB::log_debug(const std::string& message);  // Logs with LogLevel::Debug
void SpacetimeDB::log_trace(const std::string& message);  // Logs with LogLevel::Trace
```
**Example:**
```cpp
#include "spacetime_sdk_runtime.h"

void my_reducer_logic() {
    SpacetimeDB::log_info("Processing reducer logic...");
    if (/* some error condition */) {
        SpacetimeDB::log_error("A critical error occurred in my_reducer_logic.");
    }
}
```

## Table Operations

Functions for interacting with SpacetimeDB tables from your module code (typically within reducers). These functions rely on the BSATN (de)serialization functions generated by macros like `SPACETIMEDB_TYPE_STRUCT_WITH_FIELDS`.

### `SpacetimeDB::table_insert()`
Inserts a new row into a specified table.
```cpp
template<typename TRow>
bool SpacetimeDB::table_insert(const std::string& table_name, const TRow& row_data);
```
*   **Template Parameter `TRow`**: The C++ type of the row object. A `SpacetimeDB::bsatn::serialize(bsatn::Writer&, const TRow&)` function must exist for this type (usually auto-generated by macros).
*   **Parameters:**
    *   `table_name`: The name of the target table (as defined in your schema with `SPACETIMEDB_TABLE`).
    *   `row_data`: The C++ row object to be serialized and inserted.
*   **Returns:**
    *   `true` if the host environment reported successful insertion (typically a return code of 0 from the underlying ABI call).
    *   `false` otherwise (e.g., table not found, primary key conflict, data validation error by the host).

**Example:**
```cpp
// Assuming 'Player' struct and "Players" table are defined
// Player new_player = {1, "Alice", 100};
// bool success = SpacetimeDB::table_insert("Players", new_player);
// if (!success) {
//     SpacetimeDB::log_error("Failed to insert player " + new_player.username);
// }
```

### `SpacetimeDB::table_delete_by_pk()`
Deletes a row from a specified table using its primary key value.
```cpp
template<typename TPK>
bool SpacetimeDB::table_delete_by_pk(const std::string& table_name, const TPK& pk_value);
```
*   **Template Parameter `TPK`**: The C++ type of the primary key value. A `SpacetimeDB::bsatn::serialize(bsatn::Writer&, const TPK&)` function must exist for this type.
*   **Parameters:**
    *   `table_name`: The name of the target table.
    *   `pk_value`: The primary key value of the row to be deleted.
*   **Returns:**
    *   `true` if the host environment reported successful deletion.
    *   `false` otherwise (e.g., table not found, row with specified PK not found).

**Example:**
```cpp
// std::string player_name_to_delete = "OldUser";
// bool success = SpacetimeDB::table_delete_by_pk<std::string>("Players", player_name_to_delete);
// if (success) {
//     SpacetimeDB::log_info("Player " + player_name_to_delete + " deleted.");
// }
```

### Future Table Operations (Conceptual)
The SDK may be extended with more table operations, such as:
*   `table_update<TRow>(const std::string& table_name, const TRow& row_data)`: Updates an existing row (identified by its PK within `row_data`).
*   `table_get_by_pk<TRow, TPK>(const std::string& table_name, const TPK& pk_value) -> std::optional<TRow>`: Retrieves a row by its primary key. This would involve BSATN deserialization of the returned row data.

## Transaction Context (Conceptual)

Functions to get information about the current transaction or event being processed.
*(Note: Specific ABI functions for these are TBD and not yet fully wrapped in this version of the SDK runtime documentation.)*

*   **Get Transaction ID**: `uint64_t SpacetimeDB::context_get_transaction_id();` (Example)
*   **Get Sender Identity**: `std::vector<std::byte> SpacetimeDB::context_get_sender_identity();` (Example)
*   **Get Timestamp**: `uint64_t SpacetimeDB::context_get_timestamp();` (Example)

## Scheduling Reducers (Conceptual)

Functions to schedule a reducer to be executed at a later time.
*(Note: Specific ABI functions for these are TBD and not yet fully wrapped.)*

*   `SpacetimeDB::schedule_reducer(uint64_t nanoseconds_from_now, const std::string& reducer_name, Args... args);` (Example)
    *   This would involve serializing `args...` into BSATN for the host.
```
